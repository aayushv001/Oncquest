<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Edit Record</title>
    <style>
        .grid-container {
          display: grid;
          grid-template-columns:  auto auto auto auto auto auto auto auto auto auto auto auto auto auto auto auto auto auto auto auto ;
        }
        .grid-item {
          
          border: 1px solid #b08bf8;
          padding: 2px;
          font-size: 15px;
          text-align: left;
        }
        button {
        -webkit-appearance: none;
        width: auto;
        border-radius: 24px;
        text-align: center;
        padding: 15px 40px;
        margin-top: 5px;
        background-color: #b08bf8;
        color: #ffffff;
        font-size: 14px;
        margin-left: auto;
        font-weight: 500;
        box-shadow: 0px 2px 6px -1px rgb(0 0 0 / 13%);
        border: none;
        transition: all 0.3s ease;
        outline: 0;}
        input[type=submit] {
        -webkit-appearance: none;
        width: auto;
        border-radius: 24px;
        text-align: center;
        padding: 15px 40px;
        margin-top: 5px;
        margin-bottom:15px;
        background-color: #b08bf8;
        color: #ffffff;
        font-size: 14px;
        margin-left: auto;
        font-weight: 500;
        box-shadow: 0px 2px 6px -1px rgb(0 0 0 / 13%);
        border: none;
        transition: all 0.3s ease;
        outline: 0;
        }
        input[type=submit]:disabled,input[type=submit][disabled]
        {
            background-color:#cccccc;
            color:#666666;
        }
        html{height=100%;}
        body{height=100%;}
        .grid-button
        {-webkit-appearance: none;
        width: auto;
        min-width: 100px;
        border-radius: 24px;
        text-align: center;
        padding: 5px 13px;
        margin-top: 2px;
        background-color: #b08bf8;
        color: #ffffff;
        font-size: 14px;
        margin-left: auto;
        font-weight: 500;
        box-shadow: 0px 2px 6px -1px rgb(0 0 0 / 13%);
        border: none;
        transition: all 0.3s ease;
        outline: 0;

        }
        ##wrapper
        {
            display:flex;
            justify-content:center;
        }
</style>
</head>
<body onload="checkrole()" >
<div>
<form action="register" method="POST" id="register" style="display:none;" >
{%csrf_token%}
<input type="submit" value="Add User" id="adduser" style="text-align: left;">
</form>
<form action="StartOp"id="StartOp" style="display: none;">
<input type="submit" value="Admin Page">
</form>
<form action="CAtracker" style="display: inline;">
<input type="submit" value="Edit Record">
</form>
<form action="home" method="POST" style="display: inline;">
{%csrf_token%}
<input type="submit" value="{{role}}" id="role" style="float:right;">
<input type="submit" value="{{result}}" id="name" style="float:right;">
<input type="submit" value="Logout" style="float:right;">
</form>
<form action="exportdata" style="display:inline;">
<input type="submit" value="Export Data" id="expdata">
</form>
<form action="dash" style="display:inline;">
<input type="submit" value="Dashboard" id="dash">
</form>
</div>
<form name="working"  action="loaddb" method="POST" id="working" autocomplete="off">
{%csrf_token%}
<div class="container-fluid">
<div class="row g-2">
<div class="col-md">
<div class="form-floating md-3">
<input type="text" placeholder="SRF ID" name="SRFID" id="SRFID" class="form-control" maxlength="13">
<label for="SRFID">SRFID</label>
</div>
</div>
<div class="col-md"><div class="form-floating mb-3">
<button type="button" id="search" onclick="searchSrf()">Search</button>
</div>
</div>
<div class="col-md">
<div class="form-floating mb-3">
</div>
</div>
<div class="col-md">
<div class="form-floating mb-3">
</div>
</div>
<div class="col-md">
<div class="form-floating mb-3">
</div>
</div>
<div class="col-md">
<div class="form-floating mb-3">
</div>
</div>
</div>
<div class="row g-2">
<div class="col-md">
<div class="form-floating mb-3">
    <input type="text" placeholder="Barcode" name="bcode" id="bcode" class="form-control" >
    <label for="bcode">Barcode</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Patient Name" name="pname" id="pname" class="form-control" >
    <label for="pname">Patient Name</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Mobile" name="mobno" id="mobno"  class="form-control" maxlength="10">
    <label for="mobno">Mobile</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3"> 
    <input type="text" placeholder="Age" name="age" id="age"class="form-control" >
    <label for="age">Age</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder= "Gender" name="gender" list="Browser" id="gender" class="form-control" >
    <label for="gender">Gender</label>
    <datalist id="Browser">
      <option value="Male">
      <option value="Female">
      <option value="Other">
    </datalist>
    </div>
    </div>
    <div class="col-md">
<div class="form-floating mb-3">
    <input type="text" placeholder="Address" name="address" id="address" class="form-control" >
    <label for="address">address</label>
    </div>
    </div>
    </div>  
<div class="row g-2">
<div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Client Code" name="ccode" id="ccode" class="form-control">
    <label for="ccode">Client Code</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Doctor" name="dname" id="dname"class="form-control" >
    <label for="dname">Doctor Name</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Remarks" name="rem" id="rem" class="form-control">
    <label for="rem">Remarks</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Collection EXE" name="cexe" id="cexe" class="form-control">
    <label for="cexe">Collection Executive</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="email" placeholder="Email" name="email" id="email" class="form-control">
    <label for="email">Email</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Location" name="loc"id="loc" class="form-control">
    <label for="loc">Location</label>
    </div>
    </div>
    </div>
    <div class="row g-2">
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Run No" name="runid" id="runid" class="form-control" disabled>
    <label for="runid">Run Number</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Run Time" name="runtime" id="runtime" class="form-control">
    <label for="runtime">Runtime</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="ICMR Update" name="icmrup" id="icmrup" list="liicmrup" class="form-control">
    <label for="icmrup">ICMR Update</label>
    <datalist id="liicmrup">
      <option value="Yes">
      <option value="No">
    </datalist>
    </div>
    </div>
    <div class="col-md">
<div class="form-floating mb-3">
    <input type="text" placeholder="AccessionID" name="accid" id="accid" class="form-control">
    <label for="accid">AccessionID</label>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="Result" name="res" id="res" list="lires" class="form-control">
    <label for="res">Result</label>
    <datalist id="lires">
      <option value="Positive">
      <option value="Negative">
    </datalist>
    </div>
    </div>
    <div class="col-md">
    <div class="form-floating mb-3">
    <input type="text" placeholder="CT Value" name="ctval"id="ctval" class="form-control" disabled>
    <label for="ctval">CT Value</label>
    </div>
    </div>
    </div>
    </div>
    <p style="text-align:center;">
    <input type="submit" value="Submit" id="submit" onclick="Validate()">
    <button type="button"  id="clear" onclick="reset()">Clear</button>
    </p>
    <input type="hidden" id="runstat" value="{{runstat}}">
</form>

<!--<form id="searchdb" >
    
    SRF ID:<input type="text" id="dbid">
    <button type="button" id="dbsrfbtn" onclick="dbsrf()">Search</button>
</form>-->
<div class="grid-container">
    <div class="grid-item">SRFID</div>
    <div class="grid-item">Barcode</div>
    <div class="grid-item">Patient Name</div>  
    <div class="grid-item">Mobile</div>
    <div class="grid-item">Age</div>
    <div class="grid-item">Gender</div>  
    <div class="grid-item">Address</div>
    <div class="grid-item">Client Code</div>
    <div class="grid-item">Doctor</div>
    <div class="grid-item">Remarks</div>
    <div class="grid-item">Collection Executive</div>
    <div class="grid-item">Email</div>
    <div class="grid-item">Location</div>
    <div class="grid-item">Run Number</div>
    <div class="grid-item">Runtime</div>  
    <div class="grid-item">ICMR Update</div>
    <div class="grid-item">AccessionID</div>
    <div class="grid-item">Result</div>
    <div class="grid-item">CT Value</div>
    <div class="grid-item">Load Record</div>
    {% for item in sql%}
    <div class="grid-item">{{item.0}}</div>
    <div class="grid-item">{{item.1}}</div>
    <div class="grid-item">{{item.2}}</div>  
    <div class="grid-item">{{item.3}}</div>
    <div class="grid-item">{{item.4}}</div>
    <div class="grid-item">{{item.5}}</div>  
    <div class="grid-item">{{item.6}}</div>
    <div class="grid-item">{{item.7}}</div>
    <div class="grid-item">{{item.8}}</div>
    <div class="grid-item">{{item.9}}</div>
    <div class="grid-item">{{item.10}}</div>
    <div class="grid-item">{{item.11}}</div>  
    <div class="grid-item">{{item.12}}</div>
    <div class="grid-item">{{item.13}}</div>
    <div class="grid-item">{{item.14}}</div>
    <div class="grid-item">{{item.15}}</div>
    <div class="grid-item">{{item.16}}</div>
    <div class="grid-item">{{item.17}}</div>
    <div class="grid-item">{{item.18}}</div>
    <div class="grid-item"><button id="{{item.0}}" onclick="getDataFromTable(this.id)" class="grid-button">Select</button></div>
    {% endfor %}
  </div>
<script>
    var name="{{result}}";
    var sampleCount="{{sampleCount}}"
    var role="{{role}}";
    var runid=parseInt("{{runno}}");
    res={{sqljson|safe}};
    regres={{regdata|safe}};
    chkres={{chkdata|safe}};
    document.getElementById("name").disabled=true;
    document.getElementById("role").disabled=true;
    function dbsrf()
    {   
        
        imax=parseInt("{{dblen}}");
        for(let i=0;i<imax;i++)
        {   
            if(document.getElementById("dbid").value==res[i][0])
            {
                console.log("Found");
            }
        }
    }
    
    function checkrole()
    {    
        if("{{role}}"=="SR")
        { if("{{runstat}}"!="R"){$("input, select, option, textarea", "#working").prop('disabled',true);}
        else{
            document.getElementById('res').disabled=true;
            document.getElementById('ctval').disabled=true;
            document.getElementById('accid').disabled=true;
        }
        }
        else if("{{role}}"=="RECEIVING")
        {
            document.getElementById('SRFID').disabled=true;
            document.getElementById('bcode').disabled=true;
            document.getElementById('pname').disabled=true;
            document.getElementById('mobno').disabled=true;
            document.getElementById('age').disabled=true;
            document.getElementById('gender').disabled=true;
            document.getElementById('address').disabled=true;
            document.getElementById('ccode').disabled=true;
            document.getElementById('dname').disabled=true;
            document.getElementById('rem').disabled=true;
            document.getElementById('cexe').disabled=true;
            document.getElementById('email').disabled=true;
            document.getElementById('loc').disabled=true;
            document.getElementById('runid').disabled=true;
            document.getElementById('runtime').disabled=true;
            document.getElementById('icmrup').disabled=true;
            document.getElementById('accid').disabled=false;
            document.getElementById('res').disabled=true;
            document.getElementById('ctval').disabled=true;
        }
        else if("{{role}}"=="REPORTING")
        {   if("{{runstat}}"!="ER")
        {$("input, select, option, textarea", "#working").prop('disabled',true);}
        else{
            document.getElementById('SRFID').disabled=true;
            document.getElementById('bcode').disabled=true;
            document.getElementById('pname').disabled=true;
            document.getElementById('mobno').disabled=true;
            document.getElementById('age').disabled=true;
            document.getElementById('gender').disabled=true;
            document.getElementById('address').disabled=true;
            document.getElementById('ccode').disabled=true;
            document.getElementById('dname').disabled=true;
            document.getElementById('rem').disabled=true;
            document.getElementById('cexe').disabled=true;
            document.getElementById('email').disabled=true;
            document.getElementById('loc').disabled=true;
            document.getElementById('runid').disabled=true;
            document.getElementById('runtime').disabled=true;
            document.getElementById('icmrup').disabled=true;
            document.getElementById('accid').disabled=true;
            document.getElementById('res').disabled=false;
            document.getElementById('ctval').disabled=true;
        }   
        }
        else{
            document.getElementById("StartOp").style.display="inline";
            document.getElementById("register").style.display="inline";
        }
    }
    function searchSrf()
    {   
        len=parseInt("{{chklen}}");
        var flag=0;
        var srfid=document.getElementById('SRFID').value;
        reset();
        document.getElementById('SRFID').value=srfid;
        for(i=0;i<len;i++)
        {
            if(document.getElementById('SRFID').value==chkres[i][0])
            {   reset();
                if("NC"==chkres[i][9]||"PC"==chkres[i][9])
                {
                    alert("You do not have permission to edit this data")
                    flag=1
                }
                else{
                document.getElementById('SRFID').value=chkres[i][0];
                document.getElementById('bcode').value=chkres[i][1];
                document.getElementById('pname').value=chkres[i][2];
                document.getElementById('mobno').value=chkres[i][3];
                document.getElementById('mobno').value=chkres[i][3];
                document.getElementById('age').value=chkres[i][4];
                document.getElementById('gender').value=chkres[i][5];
                document.getElementById('address').value=chkres[i][6];
                document.getElementById('ccode').value=chkres[i][7];
                document.getElementById('dname').value=chkres[i][8];
                document.getElementById('rem').value=chkres[i][9];
                document.getElementById('cexe').value=chkres[i][10];
                document.getElementById('email').value=chkres[i][11];
                document.getElementById('loc').value=chkres[i][12];
                document.getElementById('runid').value=chkres[i][13];
                document.getElementById('runtime').value=chkres[i][14];
                document.getElementById('icmrup').value=chkres[i][15];
                document.getElementById('accid').value=chkres[i][16];
                document.getElementById('res').value=chkres[i][17];
                document.getElementById('ctval').value=chkres[i][18];
                flag=1;
                }
            }
        }
        if(flag==0)
        {
        reglen=parseInt("{{reglen}}");
        for(i=0;i<reglen;i++)
        {
            if(document.getElementById('SRFID').value==regres[i][0])
            {   reset();
                document.getElementById('SRFID').value=regres[i][0]
                document.getElementById('pname').value=regres[i][1];
                document.getElementById('mobno').value=regres[i][2];
                document.getElementById('mobno').value=regres[i][2];
                document.getElementById('age').value=regres[i][3];
                document.getElementById('gender').value=regres[i][4];
                document.getElementById('address').value=regres[i][5];
                document.getElementById('ccode').value=regres[i][6];
                document.getElementById('dname').value=regres[i][7];
                document.getElementById('rem').value=regres[i][8];
                document.getElementById('cexe').value=regres[i][9];
                document.getElementById('email').value=regres[i][10];
                document.getElementById('runid').value=runid;
                break;
            }
        }
        }


    }
    function reset()
    {
        document.getElementById('working').reset();
    }
    function getDataFromTable(id)
    {   reset();
        srfid=parseInt(id);
         len=parseInt("{{dblen}}");
        for(i=0;i<len;i++)
        {
            if(srfid==res[i][0])
            {   if("NC"==res[i][9]||"PC"==res[i][9])
            {
                alert("You do not have permission to edit this data")
            }
            else{
                document.getElementById('SRFID').value=res[i][0];
                document.getElementById('bcode').value=res[i][1];
                document.getElementById('pname').value=res[i][2];
                document.getElementById('mobno').value=res[i][3];
                document.getElementById('mobno').value=res[i][3];
                document.getElementById('age').value=res[i][4];
                document.getElementById('gender').value=res[i][5];
                document.getElementById('address').value=res[i][6];
                document.getElementById('ccode').value=res[i][7];
                document.getElementById('dname').value=res[i][8];
                document.getElementById('rem').value=res[i][9];
                document.getElementById('cexe').value=res[i][10];
                document.getElementById('email').value=res[i][11];
                document.getElementById('loc').value=res[i][12];
                document.getElementById('runid').value=res[i][13];
                document.getElementById('runtime').value=res[i][14];
                document.getElementById('icmrup').value=res[i][15];
                document.getElementById('accid').value=res[i][16];
                document.getElementById('res').value=res[i][17];
                document.getElementById('ctval').value=res[i][18];
                break;
            }
            }
        }
        
    }
    function senddata()
    {
            document.getElementById('SRFID').disabled=false;
            document.getElementById('bcode').disabled=false;
            document.getElementById('pname').disabled=false;
            document.getElementById('mobno').disabled=false;
            document.getElementById('age').disabled=false;
            document.getElementById('gender').disabled=false;
            document.getElementById('address').disabled=false;
            document.getElementById('ccode').disabled=false;
            document.getElementById('dname').disabled=false;
            document.getElementById('rem').disabled=false;
            document.getElementById('cexe').disabled=false;
            document.getElementById('email').disabled=false;
            document.getElementById('loc').disabled=false;
            document.getElementById('runid').disabled=false;
            document.getElementById('runtime').disabled=false;
            document.getElementById('icmrup').disabled=false;
            document.getElementById('accid').disabled=false;
            document.getElementById('res').disabled=false;
            document.getElementById('ctval').disabled=false;
    }
    function isNumeric(num){
    num = "" + num;
    return !isNaN(num) && !isNaN(parseFloat(num));
    }
    function validateEmail() 
    {
        var re = /\S+@\S+\.\S+/;
        return re.test(document.getElementById('email').value);
    }
    function Validate()
    {   senddata();
        if(document.getElementById('SRFID').value.length==13&&isNumeric(document.getElementById('SRFID').value))
        {
            if(document.getElementById('mobno').value.length==0||(document.getElementById('mobno').value.length==10&&isNumeric(document.getElementById('mobno').value)))
            {
                if(document.getElementById('email').value.length==0||validateEmail()==true)
                {
                    if(document.getElementById('age').value.length==0||isNumeric(document.getElementById('age').value))
                    {
                        if(document.getElementById('runtime').value.length==0||isNumeric(document.getElementById('runtime').value))
                        {
                            if(document.getElementById('accid').value.length==0||isNumeric(document.getElementById('accid').value))
                            {
                                if(document.getElementById('ctval').value.length==0||isNumeric(document.getElementById('ctval').value))
                                {
                                    if(document.getElementById('gender').value.length==0||(document.getElementById('gender').value=="Male"||document.getElementById('gender').value=="Female"||document.getElementById('gender').value=="Other"))
                                    {
                                        if(document.getElementById('icmrup').value.length==0||(document.getElementById('icmrup').value=="Yes"||document.getElementById('icmrup').value=="No"))
                                        {
                                            if(document.getElementById('res').value.length==0||(document.getElementById('res').value=="Positive"||document.getElementById('res').value=="Negative"))
                                            {
                                                if(document.getElementById('bcode').value.length>0)
                                                {
                                                    if(document.getElementById('pname').value.length>0)
                                                    {
                                                    return true;
                                                    }
                                                    else{
                                                        alert("Patient Name Must Be Entered")
                                                    }
                                                }
                                                else{
                                                    alert("Barcode Must Be Entered")
                                                }
                                            }
                                            else{
                                                alert("Result can only be Positive or Negative")
                                            }
                                        }
                                        else{
                                            alert("ICMR Update Can Only Be Options Provided")
                                        }
                                    }
                                    else{
                                        alert("Gender can only be options provided")
                                    }
                                }
                                else{
                                    alert("Please Enter Valid CT Value");
                                }
                            }
                            else
                            {
                                alert("Please Enter Valid Accession ID");
                            }
                        }
                        else{
                            alert("Runtime Should Be an integer");
                        }
                    }
                    else{
                        alert("Please Enter Valid Age");
                    }
                }
                else{
                    alert("Please Enter Valid Email");
                }
            }
            else
            {
                alert("Please Enter Valid Mobile Number");
            }
        }
        else{
            alert("Please Enter Valid SRFID");
            return false;
        }
    }
</script>
<script>
$('#res').on('input',function(e)
{
    if(document.getElementById('res').value=="Positive")
    {
        document.getElementById('ctval').disabled=false;
    }
    else{
        document.getElementById('ctval').disabled=true;
        document.getElementById('ctval').value = '';
    }
})
</script>
</body>
</html>