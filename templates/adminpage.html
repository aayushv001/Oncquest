<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <style>
      button {
        -webkit-appearance: none;
        width: auto;
        min-width: 100px;
        border-radius: 24px;
        text-align: center;
        padding: 15px 40px;
        margin-top: 5px;
        background-color: #b08bf8;
        color: #fff;
        font-size: 14px;
        margin-left: auto;
        font-weight: 500;
        box-shadow: 0px 2px 6px -1px rgb(0 0 0 / 13%);
        border: none;
        transition: all 0.3s ease;
        outline: 0;}
        button:disabled,button[disabled]
        {
            background-color:#cccccc;
            color:#666666;
        }
        input[type=submit]{
        -webkit-appearance: none;
        width: auto;
        min-width: 100px;
        border-radius: 24px;
        text-align: center;
        padding: 15px 40px;
        margin-top: 5px;
        background-color: #b08bf8;
        color: #fff;
        font-size: 14px;
        margin-left: auto;
        font-weight: 500;
        box-shadow: 0px 2px 6px -1px rgb(0 0 0 / 13%);
        border: none;
        transition: all 0.3s ease;
        outline: 0;
        }
        input[type=submit]:disabled,input[type=submit][disabled]
        {
            background-color:#cccccc;
            color:#666666;
        }
    </style>
</head>
<body onload="checkstat()">
<form action="register" method="POST" style="display:inline;">
    {%csrf_token%}
<input type="submit" value="Add User" id="adduser" style="text-align: left;">
<button type="button" id="startop" value="Start Operation" onclick="show()">Start Operation</button>
</form>
<form action="CAtracker" method="POST" style="display:inline;">
{%csrf_token%}
<input type="submit" value="Edit Record" id="editrec">
</form>
<form action="home" method="POST" style="display:inline;">
{%csrf_token%}
<input type="submit" value="{{role}}" id="role" style="float: right;">
<input type="submit" value="{{result}}" id="name" style="float: right;">
<input type="submit" value="Logout" style="float:right;">
</form>
<form action="exportdata" style="display:inline;">
<input type="submit" value="Export Data" id="expdata">
</form>
<form action="dash" style="display:inline;">
<input type="submit" value="Dashboard" id="dash">
</form>
<div>
<br>
<form name="working" action="pregister" method="POST" id="working" style="display: none;">
{%csrf_token%}
<div class="container-fluid">
<div class="row g-2">
<div class="col-2">
<div class="form-floating md-3">
<input type="text" placeholder="SRF ID" name="SRFID" id="SRFID" class="form-control" disabled>
<label for="SRFID">SRFID</label>
</div>
</div>
</div>
<p>
<div class="row g-2">
<div class="col-2">
<div class="form-floating md-3">
    <input type="text" placeholder="Barcode" name="bcode" id="bcode" class="form-control" disabled>
    <label for="bcode">Barcode</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Patient Name" name="pname" id="pname" class="form-control" disabled>
    <label for="pname">Patient Name</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="number" step="1" placeholder="Mobile" name="mobno" id="mobno" class="form-control" disabled>
    <label for="mobno">Mobile</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="number" step="1" placeholder="Age" name="age" id="age" class="form-control" disabled>
    <label for="age">Age</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder= "Gender" name="gender" list="Browser" id="gender" class="form-control" disabled>
    <label for="gender">Gender</label>
    <datalist id="Browser">
      <option value="Male">
      <option value="Female">
      <option value="Other">
    </datalist>  
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Address" name="address" id="address" class="form-control" disabled>
    <label for="address">address</label>
    </div>
    </div>
    </div>
    </p>
    <p>
    <div class="row g-2">
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Client Code" name="ccode" id="ccode" class="form-control" disabled>
    <label for="ccode">Client Code</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Doctor" name="dname" id="dname" class="form-control" disabled>
    <label for="dname">Doctor Name</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Remarks" name="rem" id="rem" class="form-control" disabled>
    <label for="rem">Remarks</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Collection EXE" name="cexe" id="cexe" class="form-control"disabled>
    <label for="cexe">Collection Executive</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="email" placeholder="Email" name="email" id="email" class="form-control" disabled>
    <label for="email">Email</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Location" name="loc"id="loc" class="form-control" disabled>
    <label for="loc">Location</label>
    </div>
    </div>
    </div>
    </p>
    <p>
    <div class="row g-2">
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="number" step="1" placeholder="Run No" name="runid" id="runid" class="form-control" disabled>
    <label for="runid">Run Number</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="number" step="1" placeholder="Run Time" name="runtime" id="runtime" class="form-control" disabled>
    <label for="runtime">Runtime</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="ICMR Update" name="icmrup" id="icmrup" class="form-control" disabled>
    <label for="icmrup">ICMR Update</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="number" step="1" placeholder="AccessionID" name="accid" id="accid" class="form-control" disabled>
    <label for="accid">AccessionID</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="text" placeholder="Result" name="res" id="res" class="form-control" disabled>
    <label for="res">Result</label>
    </div>
    </div>
    <div class="col-2">
    <div class="form-floating md-3">
    <input type="number" step="1" placeholder="CT Value" name="ctval"id="ctval" class="form-control" disabled>
    <label for="ctval">CT Value</label>
    </div>
    </div>
    </div>
</p>
</div>
<p style="text-align: center;">
    <br>
    <input type="submit" value="Submit" id="submit"  disabled>
    &emsp;
    <button type="button"  id="clear" onclick="reset()" disabled> Clear </button>
</p>


<button type="button" id="endrun"  onclick="er()" style="float:right;" disabled>End Run</button>
<button type="button" id="startrun" style="float: right;" onclick="sr()" disabled>Start Run</button>
<button type="button" id="startday" onclick="sd()" style="float: left;">Start Day</button>
</form>
<!--<form action="endrun" id="endrunform" method="POST" style="display:none">
{%csrf_token%}
<input type="submit" id="endrun" value="End Run" style="float:right;" disabled>
</form>-->
<form action="endday" method="POST" id="endday" style="display: none;">
    {%csrf_token%}
    <input type="submit" id="btnendday" value="End Day">
</form>
</div>
<script>
    var runstat="{{runstat}}";
    var runno=parseInt("{{runno}}");
    document.getElementById("name").disabled=true;
    document.getElementById("role").disabled=true;
    function getdatetime()
    {   var d=new Date();
        var Year=(d.getFullYear()).toString();
        var Month=(d.getMonth()+1).toString();
        if(Month.length<2)
        {
            Month="0"+Month;
        }
        var Day=(d.getDate()).toString();
        if(Day.length<2)
        {
            Day="0"+Day;
        }
        var Hour=(d.getHours()).toString();
        if(Hour.length<2)
        {
            Hour="0"+Hour;
        }
        var Minute=(d.getMinutes()).toString();
        if(Minute.length<2)
        {
            Minute="0"+Minute;
        }
        var Second=(d.getSeconds()).toString();
        if(Second.length<2)
        {
            Second="0"+Second;
        }
        var datetime=Year+Day+Hour+Minute+Second+"0";
        return datetime;
    }
    function checkstat()
    {   
        if(runstat.localeCompare("R")==0)
        {
         document.getElementById("startday").disabled=true;
         document.getElementById('startrun').disabled=true;
         document.getElementById('endrun').disabled=false;
         document.getElementById('btnendday').disabled=true; 
         document.getElementById("SRFID").disabled=false;
         document.getElementById('bcode').disabled=false;
         document.getElementById('pname').disabled=false;
         document.getElementById('mobno').disabled=false;
         document.getElementById('age').disabled=false;
         document.getElementById('gender').disabled=false;
         document.getElementById('address').disabled=false;
         document.getElementById('ccode').disabled=false;
         document.getElementById('dname').disabled=false;
         document.getElementById('rem').disabled=false;
         document.getElementById('cexe').disabled=false;
         document.getElementById('email').disabled=false;
         document.getElementById('loc').disabled=false;
         document.getElementById('runtime').disabled=false;
         document.getElementById('icmrup').disabled=false;
         document.getElementById('accid').disabled=false;
         document.getElementById('res').disabled=false;
         document.getElementById('ctval').disabled=false;
         document.getElementById('submit').disabled=false;
         document.getElementById('clear').disabled=false;   
        }
        else if(runstat.localeCompare("ER")==0)
        {
            document.getElementById('startrun').disabled=false;
            document.getElementById('endrun').disabled=true;
            document.getElementById('btnendday').disabled=false;
            document.getElementById('startday').disabled=true;
            document.getElementById("SRFID").disabled=true;
            document.getElementById('bcode').disabled=true;
            document.getElementById('pname').disabled=true;
            document.getElementById('mobno').disabled=true;
            document.getElementById('age').disabled=true;
            document.getElementById('gender').disabled=true;
            document.getElementById('address').disabled=true;
            document.getElementById('ccode').disabled=true;
            document.getElementById('dname').disabled=true;
            document.getElementById('rem').disabled=true;
            document.getElementById('cexe').disabled=true;
            document.getElementById('email').disabled=true;
            document.getElementById('loc').disabled=true;
            document.getElementById('runtime').disabled=true;
            document.getElementById('icmrup').disabled=true;
            document.getElementById('accid').disabled=true;
            document.getElementById('res').disabled=true;
            document.getElementById('ctval').disabled=true;
            document.getElementById('submit').disabled=false;
            document.getElementById('clear').disabled=false;
            
        }
        else if(runstat.localeCompare("ED")==0)
        {
            document.getElementById('startrun').disabled=true;
            document.getElementById('startday').disabled=false;
            document.getElementById('btnendday').disabled=true;
            document.getElementById('endrun').disabled=true;
            document.getElementById('submit').disabled=true;
        }
            document.getElementById('SRFID').disabled=true;
            document.getElementById('bcode').disabled=true;
            document.getElementById('pname').disabled=true;
            document.getElementById('mobno').disabled=true;
            document.getElementById('age').disabled=true;
            document.getElementById('gender').disabled=true;
            document.getElementById('address').disabled=true;
            document.getElementById('ccode').disabled=true;
            document.getElementById('dname').disabled=true;
            document.getElementById('rem').disabled=true;
            document.getElementById('cexe').disabled=true;
            document.getElementById('email').disabled=true;
            document.getElementById('loc').disabled=true;
            document.getElementById('runtime').disabled=true;
            document.getElementById('icmrup').disabled=true;
            document.getElementById('accid').disabled=true;
            document.getElementById('res').disabled=true;
            document.getElementById('ctval').disabled=true;
    }
    function sd()
    {
        var datetime=getdatetime();
        document.getElementById("role").disabled=true; 
        document.getElementById('SRFID').disabled=false;
        document.getElementById('bcode').disabled=false;
        document.getElementById('pname').disabled=false;
        document.getElementById('mobno').disabled=false;
        document.getElementById('age').disabled=false;
        document.getElementById('gender').disabled=false;
        document.getElementById('address').disabled=false;
        document.getElementById('ccode').disabled=false;
        document.getElementById('dname').disabled=false;
        document.getElementById('rem').disabled=false;
        document.getElementById('cexe').disabled=false;
        document.getElementById('email').disabled=false;
        document.getElementById('loc').disabled=false;
        document.getElementById('runtime').disabled=false;
        document.getElementById('icmrup').disabled=false;
        document.getElementById('accid').disabled=false;
        document.getElementById('res').disabled=false;
        document.getElementById('ctval').disabled=false;
        document.getElementById('btnendday').disabled=true;
        document.getElementById('submit').disabled=false;
        document.getElementById('clear').disabled=false;
        document.getElementById('startrun').disabled=true;
        document.getElementById('endrun').disabled=false;
        document.getElementById('startday').disabled = true;
        runstat="R"
        runno=1
        document.getElementById('SRFID').value=datetime;
        document.getElementById('rem').value="NC";
        document.getElementById('runid').value=runno;
        checkstat();
        document.getElementById('endrun').disabled=true;
        document.getElementById('startday').disabled=false;
    }
    function er()
    {   var datetime=getdatetime();
        document.getElementById("role").disabled=true; 
        document.getElementById('SRFID').value=datetime;
        document.getElementById('rem').value="PC";
        document.getElementById('runid').value=runno;
        runstat="ER";
        document.getElementById('endrun').disabled=true;
        document.getElementById('startrun').disabled=true;
        document.getElementById('btnendday').disabled=false;
        checkstat();
        document.getElementById('startrun').disabled=true;
        document.getElementById('endrun').disabled=false;
        document.getElementById('btnendday').disabled=true;
        
    }
    function sr()
    {   if(runstat!='R')
    {
        runno=runno+1;
    }
        runstat="R"
        var datetime=getdatetime();
        document.getElementById("role").disabled=true; 
        document.getElementById('runid').value=runno;
        document.getElementById('SRFID').value=datetime;
        document.getElementById('rem').value="NC";
        document.getElementById('endrun').disabled=false;
        document.getElementById('startrun').disabled=true;
        document.getElementById('btnendday').disabled=true;
        document.getElementById('submit').disabled=false;
        document.getElementById('clear').disabled=false;
        checkstat();
        document.getElementById('endrun').disabled=true;
        document.getElementById('startrun').disabled=false;
    }
    function ed()
    {   if(confirm("Are you sure you want to end your day?"))
        {
            if(runstat=="R")
            {}
            else{
            runstat='ED';
            var datetime=getdatetime();
            document.getElementById('endrun').disabled=true;
            document.getElementById('startrun').disabled=true;
            document.getElementById('btnendday').disabled=true;
            document.getElementById('startday').disabled=false;
            document.getElementById('SRFID').disabled=true;
            document.getElementById('SRFID').value=datetime;
            document.getElementById('bcode').disabled=true;
            document.getElementById('pname').disabled=true;
            document.getElementById('mobno').disabled=true;
            document.getElementById('age').disabled=true;
            document.getElementById('gender').disabled=true;
            document.getElementById('address').disabled=true;
            document.getElementById('ccode').disabled=true;
            document.getElementById('dname').disabled=true;
            document.getElementById('rem').disabled=true;
            document.getElementById('cexe').disabled=true;
            document.getElementById('email').disabled=true;
            document.getElementById('loc').disabled=true;
            document.getElementById('runid').value=-1;
            document.getElementById('runtime').disabled=true;
            document.getElementById('icmrup').disabled=true;
            document.getElementById('accid').disabled=true;
            document.getElementById('res').disabled=true;
            document.getElementById('ctval').disabled=true;
            document.getElementById('submit').disabled=true;
            document.getElementById('clear').disabled=true;
            checkstat();
            
        }
        }
        else{}
    }
    function show()
    {document.getElementById("working").style.display="inline";
    document.getElementById("endday").style.display="inline";
    }
    function reset()
    {
        document.getElementById('working').reset();
    }
    if("{{role}}"!="ADMIN")
    {
          document.getElementById("adduser").disabled = true;
    }

</script>

</body>
<script type="text/javascript">
    $(document).on('submit','#working',function(e){
       e.preventDefault();
       $.ajax({
        type:'POST',
        url:'/one/pregister',
        data:{
            'runstat':runstat,
            SRFID:$('#SRFID').val(),
            bcode:$('#bcode').val(),
            pname:$('#pname').val(),
            mobno:$('#mobno').val(),
            age:$('#age').val(),
            gender:$('#gender').val(),
            address:$('#address').val(),
            ccode:$('#ccode').val(),
            dname:$('#dname').val(),
            rem:$('#rem').val(),
            cexe:$('#cexe').val(),
            email:$('#email').val(),
            loc:$('#loc').val(),
            runid:$('#runid').val(),
            runtime:$('#runtime').val(),
            icmrup:$('#icmrup').val(),
            accid:$('#accid').val(),
            res:$('#res').val(),
            ctval:$('#ctval').val(),
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
            },
            success:function(){

                if(runstat=='R'&&runno==1)
                {
                    document.getElementById('startday').disabled=true;
                    document.getElementById('endrun').disabled=false;
                }
                else if(runstat=='R' && runno>1)
                {
                document.getElementById('endrun').disabled=false;
                document.getElementById('startrun').disabled=true;
                }
                else
                {document.getElementById('startrun').disabled=false;
                document.getElementById('endrun').disabled=true;
                document.getElementById('btnendday').disabled=false;}

                reset();
            }
       })
    })
</script>
<script type="text/javascript">

    $("#endday").on('submit',function(event){
       event.preventDefault();
           if(confirm("Are you sure you want to end your day?"))
        {
            runstat='ED';
            var datetime=getdatetime();
            document.getElementById('endrun').disabled=true;
            document.getElementById('startrun').disabled=true;
            document.getElementById('startday').disabled=false;
            document.getElementById('SRFID').disabled=true;
            document.getElementById('SRFID').value=datetime;
            document.getElementById('bcode').disabled=true;
            document.getElementById('pname').disabled=true;
            document.getElementById('mobno').disabled=true;
            document.getElementById('age').disabled=true;
            document.getElementById('gender').disabled=true;
            document.getElementById('address').disabled=true;
            document.getElementById('ccode').disabled=true;
            document.getElementById('dname').disabled=true;
            document.getElementById('rem').disabled=true;
            document.getElementById('cexe').disabled=true;
            document.getElementById('email').disabled=true;
            document.getElementById('loc').disabled=true;
            document.getElementById('runid').value=-1;
            document.getElementById('runtime').disabled=true;
            document.getElementById('icmrup').disabled=true;
            document.getElementById('accid').disabled=true;
            document.getElementById('res').disabled=true;
            document.getElementById('ctval').disabled=true;
            document.getElementById('submit').disabled=true;
            document.getElementById('clear').disabled=true;
            checkstat();
            document.getElementById('btnendday').disabled=true;
            reset();
            
        
        console.log("form submitted!")
        
       $.ajax({
        type:'POST',
        url:'/one/endday',
        data:{csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()},
        success:function(){}
        
       })
        }
        else{}
    })
    
</script>
<script type="text/javascript">
/*
$(document).ready(function() {
    $("#endrunform").on('submit',function(e){
       e.preventDefault();
        er();
        
       $.ajax({
        type:'POST',
        url:'/one/endrun',
        data:{csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()},
        success:function(){}
        
       })
    })
})*/   
</script>
</html>